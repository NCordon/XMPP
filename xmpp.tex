%%%%
% Modificación de una plantilla de Latex para adaptarla al castellano.
%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Thin Sectioned Essay
% LaTeX Template
% Version 1.0 (3/8/13)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% Original Author:
% Nicolas Diaz (nsdiaz@uc.cl) with extensive modifications by:
% Vel (vel@latextemplates.com)
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[a4paper, 11pt]{article} % Font size (can be 10pt, 11pt or 12pt) and paper size (remove a4paper for US letter paper)

\usepackage[protrusion=true,expansion=true]{microtype} % Better typography
\usepackage{graphicx} % Required for including pictures
\usepackage[usenames,dvipsnames]{color} % Coloring code
\usepackage{wrapfig} % Allows in-line images
\usepackage[utf8]{inputenc}

% Imágenes
\usepackage{graphicx} 

\usepackage{amsmath}
% para importar svg
%\usepackage[generate=all]{svgfig}

% sudo apt-get install texlive-lang-spanish
\usepackage[spanish]{babel} % English language/hyphenation
\selectlanguage{spanish}
% Hay que pelearse con babel-spanish para el alineamiento del punto decimal
\decimalpoint
\usepackage{dcolumn}
\newcolumntype{d}[1]{D{.}{\esperiod}{#1}}
\makeatletter
\addto\shorthandsspanish{\let\esperiod\es@period@code}
\makeatother

\usepackage{longtable}
\usepackage{tabu}
\usepackage{supertabular}

\usepackage{multicol}
\newsavebox\ltmcbox

% Para matrices
\usepackage{amsmath}

% Símbolos matemáticos
\usepackage{amssymb}
\let\oldemptyset\emptyset
\let\emptyset\varnothing

\usepackage[section]{placeins} % Para gráficas en su sección.
\usepackage{mathpazo} % Use the Palatino font
\usepackage[T1]{fontenc} % Required for accented characters
\newenvironment{allintypewriter}{\ttfamily}{\par}
\setlength{\parindent}{0pt}
\parskip=8pt
\linespread{1.05} % Change line spacing here, Palatino benefits from a slight increase by default

\makeatletter
\renewcommand\@biblabel[1]{\textbf{#1.}} % Change the square brackets for each bibliography item from '[1]' to '1.'
\renewcommand{\@listI}{\itemsep=0pt} % Reduce the space between items in the itemize and enumerate environments and the bibliography
\newcommand{\imagen}[2]{\begin{center} \includegraphics[width=90mm]{#1} \\#2 \end{center}}

\renewcommand{\maketitle}{ % Customize the title - do not edit title and author name here, see the TITLE block below
\begin{flushright} % Right align
    {\LARGE\@title} % Increase the font size of the title
    
    \vspace{50pt} % Some vertical space between the title and author name
    
    {\large\@author} % Author name
    \\\@date % Date
    
    \vspace{40pt} % Some vertical space between the author block and abstract
\end{flushright}
}


%Basado en: http://en.wikibooks.org/wiki/LaTeX/Theorems
\usepackage{amsthm}
\newtheorem*{mydef}{Definición}
\newtheorem{mydefn}{Definición}
\newtheorem{theorem}{Teorema}
\everymath{\displaystyle} % Displaystyle por defecto


\usepackage[usenames,dvipsnames]{xcolor}
\definecolor{dkgreen}{rgb}{0,0.35,0}
\definecolor{darkgreen}{rgb}{0,0.35,0}
\definecolor{dkviolet}{rgb}{0.3,0,0.5}
\definecolor{dkred}{rgb}{0.5,0,0}
\definecolor{dkblue}{rgb}{0, 0, 0.9}
\definecolor{darkblue}{rgb}{0, 0, 0.9}
\definecolor{ltblue}{rgb}{0.38, 0.55, 0.8}
\definecolor{maroon}{rgb}{0.5, 0.0, 0.0}
\usepackage{catchfilebetweentags}
\usepackage{verbatim}

% Listings para el código.
\usepackage{listings}
\usepackage{courier}
\lstset{basicstyle=\footnotesize\ttfamily,breaklines=true}
\lstset{frame=tb,aboveskip=3mm,belowskip=3mm,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{lgray},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true
  tabsize=3}
\lstdefinelanguage{XML}
{
  basicstyle=\ttfamily,
  morestring=[s]{"}{"},
  morecomment=[s]{?}{?},
  morecomment=[s]{!--}{--},
  commentstyle=\color{darkgreen},
  moredelim=[s][\color{black}]{>}{<},
  moredelim=[s][\color{red}]{\ }{=},
  stringstyle=\color{blue},
  identifierstyle=\color{maroon}
}


\usepackage[hidelinks]{hyperref}

\newenvironment{coq_example}{\begin{coq}}{\end{coq}}

% Tildes
\lstset{
     literate=%
         {á}{{\'a}}1
         {í}{{\'i}}1
         {é}{{\'e}}1
         {ý}{{\'y}}1
         {ú}{{\'u}}1
         {ó}{{\'o}}1
         {ě}{{\v{e}}}1
         {š}{{\v{s}}}1
         {č}{{\v{c}}}1
         {ř}{{\v{r}}}1
         {ž}{{\v{z}}}1
         {ď}{{\v{d}}}1
         {ť}{{\v{t}}}1
         {ň}{{\v{n}}}1                
         {ů}{{\r{u}}}1
         {Á}{{\'A}}1
         {Í}{{\'I}}1
         {É}{{\'E}}1
         {Ý}{{\'Y}}1
         {Ú}{{\'U}}1
         {Ó}{{\'O}}1
         {Ě}{{\v{E}}}1
         {Š}{{\v{S}}}1
         {Č}{{\v{C}}}1
         {Ř}{{\v{R}}}1
         {Ž}{{\v{Z}}}1
         {Ď}{{\v{D}}}1
         {Ť}{{\v{T}}}1
         {Ň}{{\v{N}}}1                
         {Ů}{{\r{U}}}1    
}

%----------------------------------------------------------------------------------------
%	TITLE
%----------------------------------------------------------------------------------------

\title{\textbf{Seminario 5}\\ % Title
El protocolo XMPP} % Subtitle

\author{\textsc{Ignacio Cordón,\\Mario Román} % Author
\\{\textit{Universidad de Granada}}} % Institution

\date{\today} % Date

%----------------------------------------------------------------------------------------

\begin{document}

\maketitle % Print the title


%----------------------------------------------------------------------------------------
% Escribir una ecuación:
%  \begin{align} 
%  \begin{split}
%----------------------------------------------------------------------------------------

\renewcommand{\abstractname}{Resumen} % Uncomment to change the name of the abstract to something else
\begin{abstract}
\end{abstract}
{\parskip=2pt
\tableofcontents
}
\pagebreak


%--------------------------------------------
% Documento
%--------------------------------------------

\section{Introducción al XMPP}
  El protocolo XMPP (Extensible Messaging and Presence Protocol) se usa para la mensajería
  instantánea, así como para las llamadas de voz y vídeo. El desarrollo del protocolo fue
  iniciado por \textbf{Jeremie Miller} en el 1998, continuado por la comunidad de código abierto Jabber, que dio
  nombre al proyecto, y finalmente formalizado en 2002 por la IETF.
  
  En 2004 se publicaron los RFCs del protocolo (RFC 3920, RFC 3921, RFC 3922, RFC 3923). Han vuelto a ser actualizados en 2011, y, aunque
  la base del protocolo continúa estable, la \textbf{XMPP Standards Foundation} sigue definiendo extensiones
  al protocolo.
  
  Ha sido adoptado por empresas como Facebook, Tuenti, Whatsapp y Nimbuzz, para su servicio de chat. Asimismo, Google
  también lo adoptó temporalmente en Google Talk, pero lo abandonó en detrimento de su propio protocolo Hangouts.

  En 2003 el protocolo era usado por aproximadamente 10 millones de personas, de acuerdo a los datos de la \textbf{XMPP
  Standards Foundation}	
   
   \subsection{Ventajas}
   \begin{itemize}
     \item \textbf{Descentralización}
     La arquitectura de la red XMPP es similar a la de la red email. Cualquiera puede tener su propio servidor XMPP, y
     no existe servidor central
     \item \textbf{Estándar abierto}
     La IETF ha formalizado en los RFCS 6120 y 6121 XMP como un protocolo de mensajería instantánea para el que no es
     ninguna clase de privilegio para implementar soporte de estas especificaciones, y su desarrollo no está ligado
     a un único proyecto.
     \item \textbf{Seguridad}
     Se trata de un protocolo evolucionado y mejorado desde que se creó en 1999. Los servidores XMPP pueden ser aislados
     de la red pública XMPP y los núcleos de las especificaciones XMPP proveen de una alta seguridad a través de SASL y TLS.
     
     Cabe destacar que existen múltiples implementaciones del estándar para clientes, servidores, y librerías de código.
     \item \textbf{Flexibilidad}
     Las aplicaciones XMPP, más allá de la mensajería instantánea, incluyen funcionalidades como, entre otras: chat de grupo, 
     herramientas colaborativas, compartición de archivos, control de sistemas remotos, geolocalización, VoIP, \ldots
   \end{itemize}
 
   \subsection{Desventajas}
   \begin{itemize}
    \item \textbf{Carece de soporte QoS (Quality of service)}
    La garantía de entrega de mensajes debe construirse por encima de la capa XMPP
    % ? Normally, this is done using simple sequence number attributes in stanzas.
    \item \textbf{Redundancia}
    Alreddor del 70\% del tráfico entre servidores son datos de presencia, siendo el 60\% de estos transmisiones 
    redundantes.
    \item \textbf{Escalabilidad}
    XMPP adolece del mismo problema de redundancia en sus servicios de chatroom y suscripción. Actualmente se está
    trabajando en su solución.
    \item \textbf{Ausencia de datos binarios}
    Al estar basado en XML (comunicación basada en texto), la sobrecarga de la red es mayor en comparación 
    con otros protocolos binarios. Este problema ha sido atajado por el \textit{Efficient XML Interchange (EXI) Format},
    en el que XML es fragmentado eficientemente de forma binaria.
    Ahora bien, como los datos binarios deben ser codificados en base64 antes de transmitirse de manera in-band,
    cualquier cantidad considerable de datos binarios (transferencia de archivos) debe ser transmitida out-of-band,
    empleando mensajes in-band para coordinarla. El mejor ejemplo de esto es Jingle, un protocolo de extensión de XMPP.
    
   \end{itemize}


\section{Estructura del XMPP}
  XMPP sigue una estructura cliente/servidor. El cliente y el servidor se comunican a través 
  de una conexión TCP en el puerto 5222. Y la información que se envía sobre XMPP va contenida
  en un streaming de objetos XML.
  
  \subsection{Proceso de entrega de mensajes}
    \subsubsection{Inicio de la sesión}
      La sesión se inicia con la etiqueta \texttt{<stream>} y se finalizará con la etiqueta
      \texttt{</stream>}. Por razones de seguridad, a la apertura de la comunicación le sigue
      negociación por TLS y SASL. Después de la negociación, se abre un nuevo canal de comunicación
      más seguro.
      
      Más detalladamente, para requerir un nuevo inicio de sesión, el cliente envía un paquete para la apertura:
      \begin{lstlisting}[language=XML] 
<stream:stream to='example.com' 
	  xmlns='jabber:client'
	  xmlns:stream='http://etherx.jabber.org/streams'
	  version='1.0'>
      \end{lstlisting}
      Donde \texttt{example.com} es la URL del servidor XMPP al que se conecta. El servidor
      devolverá entonces un paquete con los requisitos para la negociación TLS o SASL.
      \begin{lstlisting}[language=XML]
<stream:features> 
  <starttls xmlns='urn:ietf:params:xml:ns:xmpp-tls'>    
    <required/>  
  </starttls>  
  <mechanisms xmlns='urn:ietf:params:xml:ns:xmpp-sasl'>    
    <mechanism>DIGEST-MD5</mechanism>    
    <mechanism>PLAIN</mechanism>   
    <mechanism>EXTERNAL</mechanism>  
  </mechanisms> 
</stream:features>
      \end{lstlisting}

  \subsubsection{Encriptación y autorización}
    Si el servidor necesita una negociación TLS, el cliente enviará un \texttt{STARTTLS} al servidor:
    \begin{lstlisting}[language=XML]
<starttls xmlns='urn:ietf:params:xml:ns:xmpp-tls'/>    
    \end{lstlisting}
    A lo que el servidor responderá en función de si el TLS está permitido o si causa error:
    \begin{lstlisting}[language=XML]
<!-- Aceptado -->
<proceed xmlns='urn:ietf:params:xml:ns:xmpp-tls'/> 
<!-- Error -->
<failure xmlns='urn:ietf:params:xml:ns:xmpp-tls'/> 
    \end{lstlisting}
    Cuando es procesada la solicitud TLS, el cliente solicitará una nueva sesión, a la que el servidor
    responderá con la necesidad de una negociación SASL.

    Para la negociación SASL, el cliente debe elegir un método de autenticación entre los disponibles
    (DIGEST-MD5, PLAIN y EXTERNAL). En el caso de autorización más simple (PLAIN), se envía una cadena
    codificada como "\texttt{$\backslash$0User$\backslash$0Pass}". El servidor responderá a esto en 
    función de si acepta o no la petición:
    \begin{lstlisting}[language=XML]
<!-- Aceptado -->
<success xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/>
<!-- Error -->
<failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/>
    \end{lstlisting}

  
\section{Conexión a otros protocolos. Pasarelas}
  \subsection{Protocolos base de XMPP}
  \subsection{Extensiones a XMPP}
  \subsection{XMPP y HTTP}
  
  

  
%% ------ Bibliografía ------------------------------------------------------
\vfill
\begin{thebibliography}{9}

\bibitem{xmppSF}
  XMPP Standards Foundation. October, 2007.\\
  \url{http://xmpp.org/2007/10/what-is-xmpp/}.
  
\bibitem{xmppWiki}
  XMPP Wikipedia
  \url{http://en.wikipedia.org/wiki/XMPP}
\end{thebibliography}  
  
\end{document}